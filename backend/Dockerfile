# официальный образ Python версии 3.12.
FROM python:3.12

# Устанавливает рабочую директорию внутри контейнера.
# Все последующие команды будут выполняться в этой директории.
WORKDIR /diary-backend

# Копирует файлы `poetry.lock` и `pyproject.toml` из локальной файловой системы
# в рабочую директорию контейнера.
COPY poetry.lock pyproject.toml /diary-backend/


# Устанавливает Poetry (инструмент для управления зависимостями и упаковки Python)
# и затем устанавливает зависимости проекта, указанные в `pyproject.toml`,
# Устанавливает Poetry и устанавливает зависимости проекта.
RUN pip install poetry && \
    poetry install --no-root

# Копирует все файлы и директории из локальной файловой системы
# в рабочую директорию контейнера.
COPY . /diary-backend

# Открывает порт 8000 внутри контейнера для внешних соединений.
EXPOSE 8000

WORKDIR "app"
# Запускает приложение с использованием команды Poetry, которая
# в свою очередь запускает Uvicorn (ASGI-сервер) для приложения FastAPI.
# Приложение будет доступно на всех IP-адресах контейнера на порту 8000.
CMD ["poetry", "run", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
